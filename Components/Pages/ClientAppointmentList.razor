@inject ApplicationDbContext _dbContext;

<link rel="stylesheet" href="~/app.css" asp-append-version="true" />

@page "/client-appointment-list";
@using GymSync.Components;
@using GymSync.Data;
@using GymSync.Models;
@using GymSync.Views;
@using Microsoft.EntityFrameworkCore;

<h3>Client Appointment List</h3>

<p>This page is for displaying all of a client's appointments</p>

@if (!_ready)
{
	<p>Loading.....</p>
}
else
{
	<p class="schedule-head">this text @_currentUser.FirstName @_currentUser.LastName</p>

	@foreach(var appt in _appointmentList)
	{
		<p>@appt.appointment_id @appt.start_time @appt.end_time</p>
	}
}


@code {
	private Query _query;
	private bool _ready;

	int _client_id = 1;

	private UserView _currentUser = new UserView(0, "first", "last");
	private List<AppointmentEntity> _appointmentList = new List<AppointmentEntity>();


	protected override async Task OnInitializedAsync()
	{
		_ready = false;

		_query = new Query(_dbContext);

		//Get the current user's information for referenece on page
		_currentUser = await _query.StaffToUser(_client_id);

		//get the appointment list for the user
		foreach(var appt in await _query.ClientToAppointmentAll(_client_id))
		{
			_appointmentList.Add(appt);
		}

		
		
		_ready = true;
	}
}
