@inject ApplicationDbContext DbContext

@page "/trainer-list"
@using GymSync.Data
@using GymSync.Models
@using GymSync.Views
@using Microsoft.EntityFrameworkCore;



<PageTitle>Trainer List</PageTitle>

<h1>List of Clients per Trainer</h1>

This page lists the clients for each trainer.

@if (!_ready)
{
	<p><em>Loading...</em></p>
}
else
{
	@foreach (var group in _list)
	{
		<h3>Trainer: @group.trainer.FirstName @group.trainer.LastName</h3>
		@if (group.clients.Count > 0)
		{
			<table class="table">
				<thead>
					<tr>
						<th>Client ID</th>
						<th>Client Name</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var client in group.clients)
					{
						<tr>
							<td>@client.UserID</td>
							<td>@client.FirstName @client.LastName</td>
						</tr>
					}
				</tbody>
			</table>
		}
		else
		{
			<p>No clients found for this trainer.</p>
		}
	}
}

@code {
	private Query _query;
	private bool _ready;

	private List<(UserView trainer, List<UserView> clients)> _list = [];

	protected override async Task OnInitializedAsync() {
		_ready = false;

		_query = new Query(DbContext);

		foreach (var group in await _query.GetClientsForTrainerAll()) {
			_list.Add((group.Key, group.Values.ToList()));
		}

		_ready = true;
	}
}
